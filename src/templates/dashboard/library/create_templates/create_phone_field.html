{% extends 'dashboard/dashboard_base.html' %} {% load static %}
<!--Title-->
{% block title %}Dashboard - Start create{% endblock title %}
<!--Main content-->
<!-- Styles -->
{% block styles %}
<link
    rel="stylesheet"
    href="{% static 'css/dashboard/questionnaires/questionnaires.css' %}"
/>
{% endblock styles %}
<!-- Styles -->
<!--Header-->
{% block back %}
<div class="back-button">
<a href="{% url 'create_field_to_template' library_template.id %}">
    <img src="{% static 'images/icons/arrow-left.svg' %}" alt="Back button" />
</a>
</div>
{% endblock back %}
<!---->
{% block title_page %}–¢–µ–ª–µ—Ñ–æ–Ω{%endblock title_page %}
<!--Header-->

<!--Content-->
{% block main %} {% load static %} {% csrf_token %}
<form method="POST" id="field-form">
    {% csrf_token %}
    <div class="add_new_field marg_bottom-20 d-flex-vs-center marg_top-md-sm-15">
    <button type="submit" class="button_primary button_reset btn-icon" id="submit-button">
        <p>
            <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M7 14C6.71667 14 6.47933 13.904 6.288 13.712C6.096 13.5207 6 13.2833 6 13V8H1C0.716667 8 0.479 7.904 0.287 7.712C0.0956668 7.52067 0 7.28333 0 7C0 6.71667 0.0956668 6.479 0.287 6.287C0.479 6.09567 0.716667 6 1 6H6V1C6 0.716667 6.096 0.479 6.288 0.287C6.47933 0.0956668 6.71667 0 7 0C7.28333 0 7.521 0.0956668 7.713 0.287C7.90433 0.479 8 0.716667 8 1V6H13C13.2833 6 13.5207 6.09567 13.712 6.287C13.904 6.479 14 6.71667 14 7C14 7.28333 13.904 7.52067 13.712 7.712C13.5207 7.904 13.2833 8 13 8H8V13C8 13.2833 7.90433 13.5207 7.713 13.712C7.521 13.904 7.28333 14 7 14Z" fill="currentColor"/>
            </svg>   
        </p>
        <p>–î–æ–¥–∞—Ç–∏</p>
    </button>
    </div>
    <div class="d-flex d-flex-md-sm">
    <div class="border-field w-100-md-sm">
        <div class="input-panel">
        <div class="group-form">
            <!-- <h5 class="static-title">Telefon</h5> -->
            <label for="id_name" class="input_label">
            <input
                type="text"
                class="input-title"
                autofocus
                placeholder="–£–≤–µ–¥—ñ—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫"
                id="id_name"
                required
                name="name"
                maxlength="128"
            />
            </label>
            <span>
            <img src="{% static 'images/icons/required.svg' %}" alt="" />
            </span>
        </div>
        <div class="d-flex align-items-center phoneForm d-flex-md-sm">
            <select class="input_base languageDropdown marg_bottom-md-sm-10"></select>
            <div class="selectedLanguage"></div>
            <input
                type="text"
                placeholder="Enter phone number"
                class="input_base phoneNumberInput"
            />
            <input type="hidden" value="phone" name="extra_tag" />
        </div>
        <p>
            <label for="help_info"></label>
            <input
                type="text"
                id="help_info"
                name="help_info"
                class="input-title"
                placeholder="–¢–µ–∫—Å—Ç –ø—ñ–¥–∫–∞–∑–∫–∞"
            />
        </p>
        </div>
    </div>
    <div class="settings-panel w-100-md-sm offset-md-sm-clear">
        <div class="checkbox-container justify-content-start marg_bottom-10">
        <label class="checkbox">
            <input
                id="required-fill"
                type="checkbox"
                id="is_required"
                name="is_required"
                value="true"
            />
            <div class="circle"></div>
            <div class="box">
                <span class="checkmark"></span>
            </div>
        </label>
        <span>–û–±–æ–≤‚Äô—è–∑–∫–æ–≤–µ –¥–æ –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è</span>
        </div>
        <div class="checkbox-container justify-content-start marg_bottom-10">
        <label class="checkbox">
            <input type="checkbox" id="required-fill-help-text" />
            <div class="circle"></div>
            <div class="box">
            <span class="checkmark"></span>
            </div>
        </label>
        <span>–¢–µ–∫—Å—Ç –ø—ñ–¥–∫–∞–∑–∫–∞</span>
        </div>
        <!-- Title -->
        <div class="settings-panel-title">–¢–∏–ø –≤–≤–µ–¥–µ–Ω–Ω—è</div>
        <!-- Title -->
        <div class="radio-container marg_bottom-10">
        <div class="radio-container">
            <input
                type="radio"
                id="type-number"
                name="field_type"
                value="number"
                required
                checked
            />
            <label for="type-number">–¶–∏—Ñ—Ä–æ–≤–µ –∑–Ω–∞—á–µ–Ω–Ω—è </label>
        </div>
        </div>
        <div class="block-muted">
        <!-- Title -->
        <div class="settings-panel-title">–ö—ñ–ª—å–∫—ñ—Å—Ç—å —Å–∏–º–≤–æ–ª—ñ–≤:</div>
        <!-- Title -->
        <div class="radio-container marg_bottom-10">
            <div class="radio-container">
            <input type="radio" id="max-60" name="max_symbols" value="60" />
            <label for="max-60">–¥–æ 60</label>
            </div>
        </div>
        <div class="radio-container marg_bottom-10">
            <div class="radio-container">
            <input type="radio" id="max-250" name="max_symbols" value="250" />
            <label for="max-250">–¥–æ 250 <span>(—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)</span></label>
            </div>
        </div>
        <div class="radio-container marg_bottom-10">
            <div class="radio-container">
            <input type="radio" id="max-500" name="max_symbols" value="500" />
            <label for="max-500">–¥–æ 500</label>
            </div>
        </div>
        <div class="radio-container marg_bottom-10">
            <div class="radio-container">
            <input
                type="radio"
                id="static"
                name="max_symbols"
                value="static"
                checked
            />
            <label for="static">–°—Ç–∞–ª–µ –∑–Ω–∞—á–µ–Ω–Ω—è</label>
            </div>
            <div class="group-input-value" id="static-value-block">
            <input
                type="number"
                class="input_base"
                id="static_value"
                name="static_value"
                style="width: 100px"
                value="12"
            />
            </div>
        </div>
        </div>
    </div>
    </div>
</form>

<!-- <div class="add-new-lang-block">
<a href="#" class="button_primary_outline button_reset" id="copy-button">
    –ó–±–µ—Ä–µ–≥—Ç–∏ —ñ –¥–æ–¥–∞—Ç–∏ —ñ–Ω—à–æ–º–æ–≤–Ω–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç
</a>
</div> -->
{% endblock main %}
<!-- Content -->
{% block scripts %}
<script src="{% static 'js/questionnaire/phone.js' %}"></script>
<script>
document.addEventListener("DOMContentLoaded", function () {
    const copyButton = document.getElementById("copy-button");
    const submitButton = document.getElementById("submit-button");
    const form = document.getElementById("field-form");

    function handleFormSubmission(event, redirectUrl) {
        event.preventDefault(); // –ó–∞–ø–æ–±—ñ–≥–∞—î–º–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ–π –ø–æ–≤–µ–¥—ñ–Ω—Ü—ñ —Ñ–æ—Ä–º–∏

        const formData = new FormData(form);

        // –í–∏–∫–æ–Ω—É—î–º–æ –∑–∞–ø–∏—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä
        fetch("{% url 'create_field_template' library_template.id %}", {
            method: "POST",
            body: formData,
        })
        .then((response) => response.json())
        .then((data) => {
        if (data.status === "success") {
            alert(data.message);

            // –ü–µ—Ä–µ—Ö—ñ–¥ –∑–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º –ø—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ—ó –≤—ñ–¥–ø—Ä–∞–≤–∫–∏
            window.location.href = redirectUrl;
        }
        else {alert("–ü–æ–º–∏–ª–∫–∞: " + data.message);}
        })
        .catch((error) => console.error("–ü–æ–º–∏–ª–∫–∞:", error));
    }

    // –î–æ–¥–∞—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ submit
    REDIR_URL = "{% if library_template.combined_block %} {% url 'create_combined_block_template' library_template.id %} {% else %} {% url 'create_field_to_template' library_template.id %} {% endif %}"
    submitButton.addEventListener("click", function (e) {
        handleFormSubmission(e,REDIR_URL);
    });

    // –î–æ–¥–∞—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫ –¥–ª—è –ø–æ—Å–∏–ª–∞–Ω–Ω—è
    copyButton.addEventListener("click", function (e) {
        handleFormSubmission(e, copyButton.href);
    });
});
</script>
<script>
    // –ú–∞—Å–∏–≤ –∑ –º–æ–≤–∞–º–∏
    const languages = [
        { code: "cz", name: "Czech Republic", flag: "üá®üáø", phoneCode: "+420" },
        { code: "de", name: "Germany", flag: "üá©üá™", phoneCode: "+49" },
    ];

    // –§—É–Ω–∫—Ü—ñ—è —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó —Ñ–æ—Ä–º–∏
    function initializePhoneForm(form) {
        const languageDropdown = form.querySelector(".languageDropdown");
        const selectedLanguage = form.querySelector(".selectedLanguage");
        const phoneNumberInput = form.querySelector(".phoneNumberInput");

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
        let currentLanguage = languages[0];
        updateLanguageDisplay(currentLanguage);
        setPhoneNumberMask(currentLanguage);

        // –§—É–Ω–∫—Ü—ñ—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –º–æ–≤–∏
        function updateLanguageDisplay(language) {
            selectedLanguage.innerHTML = `${language.flag} ${language.name}`;
            languageDropdown.value = language.code;
        }

        // –§—É–Ω–∫—Ü—ñ—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –º–∞—Å–∫–∏ –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω—É
        function setPhoneNumberMask(language) {
            phoneNumberInput.value = language.phoneCode;
            phoneNumberInput.setAttribute(
            "placeholder",
            `${language.phoneCode} XXX-XXX-XXX`
            );
            phoneNumberInput.addEventListener("input", () => {
            if (!phoneNumberInput.value.startsWith(language.phoneCode)) {
                phoneNumberInput.value = language.phoneCode;
            }
            });
        }

        // –û–±—Ä–æ–±–Ω–∏–∫ –∑–º—ñ–Ω–∏ –º–æ–≤–∏
        languageDropdown.addEventListener("change", (event) => {
            const selectedCode = event.target.value;
            currentLanguage = languages.find((lang) => lang.code === selectedCode);
            updateLanguageDisplay(currentLanguage);
            setPhoneNumberMask(currentLanguage);
        });

        // –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ dropdown
        function populateLanguageDropdown() {
            languages.forEach((language) => {
            const option = document.createElement("option");
            option.value = language.code;
            option.textContent = `${language.flag} ${language.name}`;
            languageDropdown.appendChild(option);
            });
        }

        // –í–∏–∫–ª–∏–∫ —Ñ—É–Ω–∫—Ü—ñ—ó –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó dropdown
        populateLanguageDropdown();

        // –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–Ω–∞—á–µ–Ω–Ω—è –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º
        languageDropdown.value = currentLanguage.code;
    }

    // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –≤—Å—ñ—Ö —Ñ–æ—Ä–º –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ
    const phoneForms = document.querySelectorAll(".phoneForm");
    phoneForms.forEach((form) => initializePhoneForm(form));
</script>
{% endblock scripts %}
